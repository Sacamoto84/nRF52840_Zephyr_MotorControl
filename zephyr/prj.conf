# GPIO & PWM
CONFIG_GPIO=y
CONFIG_PWM=y
CONFIG_PWM_NRFX=y


# ==== Логирование ====
CONFIG_CONSOLE=y                        # Включает консольный вывод
CONFIG_PRINTK=y                         # Включает printk для вывода сообщений
CONFIG_NEWLIB_LIBC_FLOAT_PRINTF=y

# Logging
CONFIG_LOG=n                            # Полностью отключает подсистему логирования Zephyr

# ---------------------------------------------------------- RTT ------------------------------------
CONFIG_USE_SEGGER_RTT=y                 # Включает драйвер SEGGER RTT
CONFIG_RTT_CONSOLE=y                    # Использует RTT как устройство консоли для printk

# Размер буфера UP (от MCU к хосту)
# По умолчанию: 1024
# Диапазон: 64 - 65536
# Рекомендуется: 1024-8192
CONFIG_SEGGER_RTT_BUFFER_SIZE_UP=8192   

CONFIG_SEGGER_SYSTEMVIEW=n               # SEGGER SystemView для профилирования
CONFIG_SEGGER_SYSTEMVIEW_BOOT_ENABLE=n   # Автостарт SystemView
CONFIG_TRACING=n                         # Включить систему трейсинга Zephyr
CONFIG_THREAD_NAME=y                     # Имена потоков (для отображения в SystemView)
CONFIG_THREAD_RUNTIME_STATS=y            # Статистика времени выполнения потоков
CONFIG_THREAD_STACK_INFO=y               # Показывать стек потоков
CONFIG_TRACING_SYSCALL=y                 # Трейсинг системных вызовов
CONFIG_TRACING_ISR=y                     # Трейсинг прерываний
CONFIG_TRACING_THREAD=y                  # Трейсинг планировщика

# Размер буфера DOWN (от хоста к MCU)
# По умолчанию: 16
# Диапазон: 16 - 1024
# Используется для ввода данных с хоста (редко нужен)
#CONFIG_SEGGER_RTT_BUFFER_SIZE_DOWN=16

# Количество UP буферов (каналов)
# По умолчанию: 3
# Канал 0: Terminal
# Канал 1: SysView
# Канал 2: Пользовательский
#CONFIG_SEGGER_RTT_MAX_NUM_UP_BUFFERS=3

#CONFIG_SEGGER_RTT_MAX_NUM_DOWN_BUFFERS=3 # Количество DOWN буферов. По умолчанию: 3

# Режим поведения при переполнении буфера. 
#CONFIG_SEGGER_RTT_MODE_NO_BLOCK_SKIP=y       # Отбрасывать новые данные при переполнении (по умолчанию)
#CONFIG_SEGGER_RTT_MODE_NO_BLOCK_TRIM=n       # Отбрасывать старые данные при переполнении
#CONFIG_SEGGER_RTT_MODE_BLOCK_IF_FIFO_FULL=n  # Блокировать запись до освобождения места (ОПАСНО для прерываний!)


# /RTT----------------------------------------------------------------------------------------------


# UART отключен
CONFIG_SERIAL=n                         # Полностью отключает драйвер последовательного порта (UART/USART
CONFIG_UART_CONSOLE=n                   # Отключает использование UART как устройства консоли
CONFIG_UART_LINE_CTRL=n                 # Отключает API управления линией UART (DTR, RTS, flow control)
# ================================================

# Bluetooth - минимальная конфигурация
CONFIG_BT=y
CONFIG_BT_PERIPHERAL=y
CONFIG_BT_BROADCASTER=y
CONFIG_BT_OBSERVER=y
CONFIG_BT_DEVICE_NAME="Motor_Controller"
CONFIG_BT_DEVICE_APPEARANCE=833
CONFIG_BT_MAX_CONN=1
CONFIG_BT_GATT_DYNAMIC_DB=y

# Отключаем ненужное BLE
CONFIG_BT_SMP=n
CONFIG_BT_PRIVACY=n
CONFIG_BT_SETTINGS=n


# TX Power - минимальная мощность
CONFIG_BT_CTLR_TX_PWR_MINUS_20=y

# Power management - КРИТИЧНО для сна!
CONFIG_PM=y

CONFIG_PM_DEVICE=y
CONFIG_PM_DEVICE_RUNTIME=y
CONFIG_PM_POLICY_DEFAULT=y
CONFIG_TICKLESS_KERNEL=y

# System OFF mode
CONFIG_PM_S2RAM=y

# NVS (Non-Volatile Storage)
CONFIG_FLASH=y
CONFIG_FLASH_MAP=y
#Для доступа к внутренней флеш https://docs.zephyrproject.org/latest/services/storage/nvs/nvs.html
CONFIG_MPU_ALLOW_FLASH_WRITE=y
CONFIG_ZMS=y
#CONFIG_NVS=y

# Оптимизация памяти BLE
CONFIG_BT_BUF_ACL_RX_SIZE=27
CONFIG_BT_BUF_ACL_TX_SIZE=27
CONFIG_BT_CTLR_DATA_LENGTH_MAX=27
CONFIG_BT_BUF_CMD_TX_SIZE=65
CONFIG_BT_L2CAP_TX_BUF_COUNT=3
CONFIG_BT_CTLR_ADV_DATA_LEN_MAX=31

# Размер стека - оптимизировано
CONFIG_MAIN_STACK_SIZE=1024
CONFIG_SYSTEM_WORKQUEUE_STACK_SIZE=1024
CONFIG_BT_RX_STACK_SIZE=1024

# Отключение ненужных функций
CONFIG_TIMESLICING=n
CONFIG_BOOT_BANNER=n

# BLE Connection interval для экономии
CONFIG_BT_PERIPHERAL_PREF_MIN_INT=80
CONFIG_BT_PERIPHERAL_PREF_MAX_INT=160
CONFIG_BT_PERIPHERAL_PREF_LATENCY=4
CONFIG_BT_PERIPHERAL_PREF_TIMEOUT=400

# Отключить низкую задержку
CONFIG_BT_CTLR_LOW_LAT=n

# Разрешить BLE спать между событиями
CONFIG_BT_CTLR_ADVANCED_FEATURES=y



# ADC
CONFIG_ADC=y
CONFIG_NRFX_SAADC=y

# ============================================
# BOOTLOADER (MCUboot)
# ============================================
# CONFIG_BOOTLOADER_MCUBOOT=y

# Image signing
#CONFIG_MCUBOOT_SIGNATURE_KEY_FILE="bootloader/mcuboot/root-rsa-2048.pem"

# ============================================
# IMAGE MANAGEMENT
# ============================================
# CONFIG_IMG_MANAGER=y
# CONFIG_IMG_ERASE_PROGRESSIVELY=y

# CONFIG_BOOT_UPGRADE_ONLY=y

# Использовать move вместо scratch
#CONFIG_BOOT_SWAP_USING_MOVE=y

# Отключить scratch
#CONFIG_BOOT_SWAP_USING_SCRATCH=n








# Включить стандартную библиотеку C
##CONFIG_NEWLIB_LIBC=y
CONFIG_CPP=y


CONFIG_MINIMAL_LIBC=y
CONFIG_PICOLIBC=n
CONFIG_POSIX_API=n
# Опционально: включить minimal C++ library (если нужна меньшая библиотека)
# CONFIG_MINIMAL_LIBC=n

# Настройки для отладки
##CONFIG_DEBUG=y
##CONFIG_DEBUG_OPTIMIZATIONS=y

# Размер стека (может потребоваться увеличение для C++)
CONFIG_MAIN_STACK_SIZE=4096
CONFIG_SYSTEM_WORKQUEUE_STACK_SIZE=2048